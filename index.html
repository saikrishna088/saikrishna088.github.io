<html>
	<head>
		<title>Street</title>
		<script src="https://d3js.org/d3.v3.min.js"></script>
		<style type="text/css">

			rect:hover {
				fill: orange;
			}
			
			#tooltip {
				position: absolute;
				width: 200px;
				height: auto;
				padding: 10px;
				background-color: white;
				-webkit-border-radius: 10px;
				-moz-border-radius: 10px;
				border-radius: 10px;
				-webkit-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
				-moz-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
				box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
				pointer-events: none;
			}
			
			#tooltip.hidden {
				display: none;
			}
			
			#tooltip p {
				margin: 0;
				font-family: sans-serif;
				font-size: 16px;
				line-height: 20px;
			}
			
			#tooltip1 {
				position: absolute;
				width: 200px;
				height: auto;
				padding: 10px;
				background-color: white;
				-webkit-border-radius: 10px;
				-moz-border-radius: 10px;
				border-radius: 10px;
				-webkit-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
				-moz-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
				box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
				pointer-events: none;
			}
			
			#tooltip1.hidden {
				display: none;
			}
			
			#tooltip1 p {
				margin: 0;
				font-family: sans-serif;
				font-size: 16px;
				line-height: 20px;
			}
			
			#leftbox {
                float:left; 
                width:50%;
                height:500px;
            }
            #rightbox{
                float:right;
                width:50%;
                height:500px;
            }

		</style>
	</head>
	<body>
		<svg id="first" width = "100%" height = "20%" style="border:2px solid blue;">
			<text id='label' x='30' y='20'>first</text>
		</svg>
		<div id="leftbox">
		<svg id="main1" width = "100%" height = "100%" style="border:2px solid red;">
			<text id='label1' x='30' y='20'>svg1</text>
			<g transform="translate(0,0)"> </g>
			</svg>
		</div>
		
		<div id="rightbox">   
		<svg id="main2" width = "100%" height = "100%" style="border:2px solid black;">
			<text id='label2' x='30' y='20'>svg2</text>
			<n transform="translate(700,0)"> </n> 
			</svg>
		</div>
		
		<p> Click on the text to update the chart with <span style='font-weight:bold;color:blue';>death by gender </span> , <b style='color:red'; >death by age / Reset chart</b> </h5> </p> 
		
		<div id="leftbox">
		<svg id="bar" width = "100%" height = "65%" style="border:2px solid green;">
			<text id='label3' x='30' y='20'>svg3</text>
			<g transform="translate(0,0)"> </g>
			</svg>
		</div>
		
		<div id="rightbox">
		<svg id="pie" width = "100%" height = "65%" style="border:2px solid orange;">
			<text id='label4' x='30' y='20'>svg4</text>
			<n transform="translate(700,0)"> </n> 
			</svg>
		</div>
	
		
		
		<div id="tooltip" class="hidden">
			<p><strong></strong></p>
			<p><span id="value"></span></p>
		</div> 
		<script> 
		//ref: side by side svg https://stackoverflow.com/questions/11333251/how-to-make-two-inser-svg-elements-side-by-side-in-a-bigger-div
					
				var tooltext = d3.select("body")    
					.append("div")  
					.style("position", "absolute")
					.style("z-index", "15")
					.style("width","100")
					.style("visibility", "hidden")
					.style("background", "yellow")
					.text(""); 
				var tooltext1 = d3.select("body")    
					.append("div")  
					.style("position", "absolute")
					.style("z-index", "15")
					.style("width","120")
					.style("visibility", "hidden")
					.style("background", "pink")
					.text(""); 
				
				var data_streets= [];
				d3.json("streets.json", function(data) {
				   data_streets=data;
				   draw_street();
				   });
				var data_ddays=[];
				d3.csv("deathdays.csv", function(data1) { 
				   data_ddays=data1;
				   draw_ddays();
				   });  

				var data_pumps=[];
				d3.csv('pumps.csv', function(data3) {
				data_pumps=data3;          
				draw_pumps();
					});

				var deaths_age_sex=[];
				d3.csv('deaths_age_sex.csv', function(data2) {
				deaths_age_sex=data2;
				draw_deaths();
					});
				 
				var selection_zoom = d3.select("#main1")
				  .attr("width", "100%")
				  .attr("height", "100%")
				  .attr("overflow", "visible")
				  .call(d3.behavior.zoom().on("zoom", function () {
				   selection_zoom.attr("transform", "translate(" + d3.event.translate + ")" + " scale(" + d3.event.scale + ")")
				  }))
				  .append("g")


		  
				function draw_street(){ //fn to draw streets outline
				var selection_street = selection_zoom.selectAll('line').data(data_streets);
				var line = selection_street.enter().append('line');
				
				line.attr("x1", function(d) {
						return d[0]["x"]*20+75;
				   })
				   .attr("y1", function(d) {
						return (1-d[0]["y"])*20+400;
				   })
				   .attr("x2", function(d) {
						return d[1]["x"]*20+75;
				   })
				   .attr("y2", function(d) {
						return (1-d[1]["y"])*20+400;
				   }).attr("stroke","black")
				   .attr("stroke-width","2");
				   
				   
				for (let k=2; k<14;k++){
					selection_street.enter().append('line').attr("x1", function(d) {
						if(d.length>k){
						console.log(k,k-2)
						return d[k-1]["x"]*20+75;}
				   })
				   .attr("y1", function(d) {
						if(d.length>k){
						return (1-d[k-1]["y"])*20+400;}
				   })
				   .attr("x2", function(d) {
						if(d.length>k){
						return d[k]["x"]*20+75;}
				   })
				   .attr("y2", function(d) {
						if(d.length>k){
						return (1-d[k]["y"])*20+400;}
				   }).attr("stroke","black")
				   .attr("stroke-width","2");
				   }
			
				}
			
				 function draw_pumps(){ 
				 var selection_pumps = selection_zoom.selectAll('rect').data(data_pumps).enter().append('rect'); 
				 selection_pumps.attr("x", function(d) { 
			   		return d["x"]*20+75;
			     })
			     .attr("y", function(d) { 
			   		return ((1-d["y"])*20 +400);
			     })
			     .attr("width", 12)
			     .attr("height",12)
			     .attr("fill","#B61869");	
			   }
			   
				var w = 500;
				var h = 100;
				
				function draw_deaths(){ 
				var selection_deaths = selection_zoom.selectAll('circle').data(deaths_age_sex).enter().append('circle');
				
				selection_deaths			
				.attr("cx", function(d) {
			   		return d["x"]*20+75;
			    })
			    .attr("cy", function(d) {
			   		return (1-d["y"]*20 +400);
			    })
			    .attr("r", 2)
			    .attr("fill",function(d) {
				if (d["age"] ==0) {return "#FF0000"}
				else if (d["age"] ==1){return "#DF9D08"}
				else if (d["age"] ==2){return "#B4BC37"}	
				else if (d["age"] ==3){return "#28CB06"}	
				else if (d["age"] ==4){return "#22987A"}		
				else if (d["age"] ==5){return "#5761C8"}
			    	}).on("mouseover", function(d){ 
					dict_gender = {0:'Male',1:'Female'}; 
					dict_age = {0:'0-10',1:'11-20',2:'21-40',3:'41-60',4:'61-80',5:'>80'};
					console.log(d['x'],d['y']);
					tooltext.text("age: " + dict_age[d["age"]] + "\n\n" +"gender: " +dict_gender[d["gender"]]);

					return tooltext.style("visibility", "visible");})
					.on("mousemove", function(){return tooltext.style("top", (d3.event.pageY-10)+"px").style("left",(d3.event.pageX+10)+"px");})/////*************
					.on("mouseout", function(){
					console.log("mouse out");
					draw_deaths();
					
					return tooltext.style("visibility", "hidden");})
					.on("click",function(d){
					
					function cluster(d){
					let x=parseFloat(d['x']),y=parseFloat(d['y']);
					radious_points=[];
					function getDistance(x1, y1, x2, y2){
						let y = x2 - x1;
						let x = y2 - y1;
						return Math.sqrt(x * x + y * y);
					}
					for (let k=0;k<deaths_age_sex.length;k++){
					var x1=parseFloat(deaths_age_sex[k]['x']),y1=parseFloat(deaths_age_sex[k]['y']);
					dist = getDistance(x,y,x1,y1);
					if(dist<=2){
					radious_points.push(deaths_age_sex[k]);
					}} return radious_points;} 					
					cluster_data = cluster(d);
					selection_zoom.selectAll('circle').remove();
					selection_zoom.selectAll('circle')
					   .data(cluster_data)
					   .enter()
					   .append('circle')
					   .attr("cx",function(p) {
						   return  p["x"]*20+75;
					   })
					   .attr("cy", function(p) {
			   		return (1-p["y"]*20 +400);
						})
						.attr("r", 3)
						.attr("fill",function(p){
						if (p["age"] ==0) {return "#FF0000"}
						else if (p["age"] ==1){return "#DF9D08"}
						else if (p["age"] ==2){return "#B4BC37"}	
						else if (p["age"] ==3){return "#28CB06"}	
						else if (p["age"] ==4){return "#22987A"}		
						else if (p["age"] ==5){return "#5761C8"}
							});
							console.log("time",d.duration);
					
					return tooltext.style("visibility", "hidden");});/*
					.on("mouseup",function(d){
					console.log("mouse-up");
					draw_deaths();*/
					 //ref: https://stackoverflow.com/questions/42334432/long-click-event-in-d3 ///*****************
					
					//Get this sircle x/y values, then augment for the tooltip
					//var xPosition = parseFloat(d3.select(this).attr("cx")) + (d["x"]) /2 ;
					//var yPosition = parseFloat(d3.select(this).attr("cy")) /2+(1-d["y"]*30 +700)/2;
					//Update the tooltip position and value
					/*tool_val = ' ' 
					//console.log(d['age'])
					tool_val='Gender: '+dict_gender[d['gender']]+',\n\nAge: '+dict_age[d['age']]
					
					d3.select("#tooltip")
						.style("left", xPosition + "px")
						.style("top", yPosition + "px")					
						.select("#value") 
						.text(tool_val);*/
					
				//idk
				d3.select('#main2').selectAll('ellipse')
							.data(data_ddays)
							.transition()
							.attr("cx",function(d,i) {
							   return  i * (15)+100;
							})
							.attr("cy", function(d) {
								return (1 - (d['deaths'] * 4))/2+400; 
							})
							.attr("rx",5)
							.attr("ry", 5)
							.attr("fill","#DF9D08");
			   //idk
				/*d3.select("#tooltip").classed("hidden", false); 
			   })
			   .on("mouseout", function() {
					d3.select("#tooltip").classed("hidden", true)
					});*/
				d3.select("span").on("click", function(){
					selection_zoom.selectAll('circle') 
					   .data(deaths_age_sex)
					   .transition()
					   .attr("cx",function(d) {
						   return  d["x"]*20+75;
					   })
					   .duration(0)
					   .attr("cy", function(d) {
			   		return (1-d["y"]*20 +400);
					})
					.attr("r", 2)
					.attr("fill",function(d){
				if (d["gender"] ==0) {return "blue"}
				else if (d["gender"] ==1){return "#F905C5"}
			    });   
				//call to death_data
				d3.select('#main2').selectAll('ellipse')
							.data(data_ddays)
							.transition()
							.attr("cx",function(d,i) {
							   return  i * (15)+100;
							})
							.attr("cy", function(d) {
								return (1 - (d['deaths'] * 4))/2+400; 
							})
							.attr("rx",5)
							.attr("ry", 5)
							.attr("fill","#DF9D08");
				}); 
			   
			   d3.select("b").on("click", function(){
					//draw_deaths();
					selection_zoom.selectAll('circle')
					   .data(deaths_age_sex)
					   .transition()
					   .attr("cx",function(d) {
						   return  d["x"]*20+75;
					   })
					   .duration(0)
					   .attr("cy", function(d) {
			   		return (1-d["y"]*20 +400);
						})
						.attr("r", 2)
						.attr("fill",function(d){
						if (d["age"] ==0) {return "#FF0000"}
						else if (d["age"] ==1){return "#DF9D08"}
						else if (d["age"] ==2){return "#B4BC37"}	
						else if (d["age"] ==3){return "#28CB06"}	
						else if (d["age"] ==4){return "#22987A"}		
						else if (d["age"] ==5){return "#5761C8"}
							});
					
					
			   
			   
				});
				
				} 
				
				function draw_ddays(){ 
					
					var selection_ddays = d3.select('#main2').selectAll('ellipse').data(data_ddays).enter().append('ellipse');
					
					selection_ddays
					.attr("cx", function(d, i) {
						return i * (15)+50;
					 })
					 .attr("cy", function(d) {
						return 400; 	
					 })
					 .attr("rx",5)
					 .attr("ry", 5)
					 .attr("fill","#DF9D08")
					 .on("mouseover", function(d,i){ 
						
					selection_zoom.selectAll('circle').remove();
						var total_deaths = 0;
						for (let t=0; t<=i; t++){
							total_deaths = total_deaths + parseInt(data_ddays[t]['deaths']);
							//console.log(i,data_ddays[t],'total:',total_deaths);
						}
						var new_data = []
						for (let l=0; l<total_deaths; l++){
						new_data.push(deaths_age_sex[l])
						}
					//console.log(new_data);
					
					//var selection_deaths = d3.select('#main1').selectAll('circle').data(deaths_age_sex).enter().append('circle');
					
					selection_zoom.selectAll('circle')
					   .data(new_data)
					   .enter()
					   .append('circle')
					   .attr("cx",function(p) {
						   return  p["x"]*20+75;
					   })
					   .attr("cy", function(p) {
			   		return (1-p["y"]*20 +400);
						})
						.attr("r", 3)
						.attr("fill",function(p){
						if (p["age"] ==0) {return "#FF0000"}
						else if (p["age"] ==1){return "#DF9D08"}
						else if (p["age"] ==2){return "#B4BC37"}	
						else if (p["age"] ==3){return "#28CB06"}	
						else if (p["age"] ==4){return "#22987A"}		
						else if (p["age"] ==5){return "#5761C8"}
							});
						
						
						tool_val='Date: '+d['date']+',\n\n Deaths: '+d['deaths']+'\n\n Total_deaths: '+total_deaths
					
					tooltext1.text(tool_val); return tooltext1.style("visibility", "visible");})
					.on("mousemove", function(){
					return tooltext1.style("top", (d3.event.pageY-10)+"px").style("left",(d3.event.pageX+10)+"px");})/////*************
					.on("mouseout", function(){ 
					
					d3.select('#main1').selectAll('circle').remove();
					draw_deaths();
					return tooltext1.style("visibility", "hidden")});
					 
					 
					 /*.on("mouseover", function(d,i) {
						console.log(d);	
						//Get this sircle x/y values, then augment for the tooltip
						var xPosition = parseFloat(d3.select(this).attr("cx")) + (i*(20) /2) ;
						var yPosition = parseFloat(d3.select(this).attr("cy")) /2+600/2;
						//Update the tooltip position and value
						var total_deaths = 0;
						for (let t=0; t<=i; t++){
							total_deaths = total_deaths + parseInt(data_ddays[t]['deaths']);
							//console.log(i,data_ddays[t],'total:',total_deaths);
						}
						tool_val='Date: '+d['date']+',\n\n Deaths: '+d['deaths']+'\n\n Total_deaths: '+total_deaths
						console.log(xPosition,yPosition,tool_val);
						
						
						d3.select("#tooltip1")
							.style("left", xPosition + "px") 
							.style("top", yPosition + "px")						
							.select("#value") 
							.text(tool_val);
					d3.select("#tooltip1").classed("hidden", false); 
					})
					.on("mouseout", function() {
						d3.select("#tooltip1").classed("hidden", true)
					});*/
					
					function dd_data_transition(){
						d3.select('#main2').selectAll('ellipse')
							.data(data_ddays)
							.transition()
							.attr("cx",function(d,i) {
							   return  i * (15)+100;
							})
							.attr("cy", function(d) {
								return (1 - (d['deaths'] * 4))/2+400; 
							})
							.attr("rx",5)
							.attr("ry", 5)
							.attr("fill","#DF9D08");
					}
}
			   
			  
			   
				
			
			
			
			
		</script>
	</body>
</html>


<html>
	<head>
		<title>Project_2</title>
		<script src="https://d3js.org/d3.v3.min.js"></script>
		<script src="https://d3js.org/queue.v1.min.js"></script>
		<script src="https://d3js.org/topojson.v1.min.js"></script>
		<script src="d3-tip.js"></script>


		<style type="text/css">
			rect:hover {
				fill: #389663;
			}
			#tooltip {
				position: absolute;
				width: 200px;
				height: auto;
				padding: 10px;
				background-color: white;
				-webkit-border-radius: 10px;
				-moz-border-radius: 10px;
				border-radius: 10px;
				-webkit-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
				-moz-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
				box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
				pointer-events: none;
			}
			
			#tooltip.hidden {
				display: none;
			}
			
			#tooltip p {
				margin: 0;
				font-family: sans-serif;
				font-size: 16px;
				line-height: 20px;
			}
			
			#tooltip1 {
				position: absolute;
				width: 200px;
				height: auto;
				padding: 10px;
				background-color: white;
				-webkit-border-radius: 10px;
				-moz-border-radius: 10px;
				border-radius: 10px;
				-webkit-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
				-moz-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
				box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
				pointer-events: none;
			}
			
			#tooltip1.hidden {
				display: none;
			}
			
			#tooltip1 p {
				margin: 0;
				font-family: sans-serif;
				font-size: 16px;
				line-height: 20px;
			}
			#leftbox {
                float:left; 
                width:50%;
                height:500px;
            }
            #rightbox{
                float:right;
                width:50%;
                height:500px;
            }
			
			  .names {
  fill: none;
  stroke: #fff;
  stroke-linejoin: round;
  }

    /* Tooltip CSS */
    .d3-tip {
    line-height: 1.5;
    font-weight: 400;
    font-family:"avenir next", Arial, sans-serif;
    padding: 6px;
    background: rgba(0, 0, 0, 0.6);
    color: #FFA500;
    border-radius: 1px;
    pointer-events: none;
    }

    /* Creates a small triangle extender for the tooltip */
    .d3-tip:after {      
      box-sizing: border-box;
      display: inline;
      font-size: 8px;
      width: 100%;
      line-height: 1.5;
      color: rgba(0, 0, 0, 0.6);
      position: absolute;
      pointer-events: none;
      
    }

    /* Northward tooltips */
    .d3-tip.n:after {
      content: "\25BC";
      margin: -1px 0 0 0;
      top: 100%;
      left: 0;
      text-align: center;
    }

    /* Eastward tooltips */
    .d3-tip.e:after {
      content: "\25C0";
      margin: -4px 0 0 0;
      top: 50%;
      left: -8px;
    }

    /* Southward tooltips */
    .d3-tip.s:after {
      content: "\25B2";
      margin: 0 0 1px 0;
      top: -8px;
      left: 0;
      text-align: center;
    }

    /* Westward tooltips */
    .d3-tip.w:after {
      content: "\25B6";
      margin: -4px 0 0 -1px;
      top: 50%;
      left: 100%;
    }

/*    text{
      pointer-events:none;
    }*/

    .details{
      color:white;
    }


		</style>
		<link rel="stylesheet" href="project2.css"> 
	</head>
	<body>
		<h1 style="text-align: center;">Analysis of Movies and TV Shows on Netflix</h1>
		<a style="color:blue;font-size:20;margin-right:20px;" href="project2_documentation.html" target="_blank">Documentation</a>
		<a style="color:blue;font-size:20;"href="https://iu.mediaspace.kaltura.com/media/t/1_qva24cch" target="_blank">Video</a>
		<svg id="first" width = "100%" height = "20%" >
		<style> .heavy { font:  25px calibri; }  </style>
				</svg>
	<div id="radio-group">
		<p>
			<input type="radio" name="filterPreset" value="By Movies"> Movies</input>
			<input type="radio" name="filterPreset" value="By Tv Shows"> Tv Shows</input>
			<input type="radio" name="filterPreset" value="Reset"> Reset All</input>
		</p>
	</div>	

		<div id="leftbox">
		<svg id="main1" width = "100%" height = "110%" >
		<style> .heavy { font:  25px calibri; }  </style>
		<text x="150" y="520" class="heavy">Netflix shows distribution by country</text>
		</svg>
		</div>
		
		<div id="rightbox">   
		<svg id="main2" width = "100%" height = "110%" >
		<style> .heavy { font:  25px calibri; }
				.light { font:  20px sans; }</style>
		<text x="300" y="430" class="light">Years from 1925 - 2021 </text>
		<text x="150" y="500" class="heavy">Netflix shows released from 1925 to 2021</text>	
		</svg>      
		</div>
		
		<svg id="dummy" width = "100%" height = "15%" >
			<text id='label' x='30' y='20'> </text>
		</svg>
		
		
		<div id="leftbox">
		<svg id="bar" width = "100%" height = "100%" >
		
		<rect x="650" y="30" width="18" height="18"
		style="fill:#4c5768;" />
		<rect x="650" y="53" width="18" height="18"
		style="fill:Sienna;" />
		<style> .heavy { font:  25px calibri; }
				.light { font:  20px sans; }</style>
		<text x="280" y="440" class="light">Genre of Movies and TV Shows </text>
		<text x="200" y="490" class="heavy">Number of shows according to Genre</text>
		
			<text id='label3' x='675' y='42'>Movie</text>
			<text id='label3' x='675' y='68'>TV Show</text>
			</svg>
		</div>
		
		<div id="rightbox">
		<svg id="pie" width = "100%" height = "100%" >
		<style> .heavy { font:  25px calibri; }
				.light { font:  20px sans; }</style>
		<text x="200" y="490" class="heavy">Distribution of Netflix shows by Ratings</text>
			</svg>
		</div>
		<svg id="dummy2" width = "100%" height = "5%" >
			<text id='label' x='30' y='20'> </text>
		</svg>		
		
			<div id="radio-group">
		<p>
			<input type="radio" name="filterPreset" value="desc"> Top 10 Shows</input>
			<input type="radio" name="filterPreset" value="asc"> Bottom 10 Shows</input>
		</p>
	</div>
		
		<div id="leftbox">
		<svg id="bar1" width = "100%" height = "80%" >
		<style> .heavy { font:  25px calibri; }
				.light { font:  20px sans; }</style>
		<text x="210" y="300" class="light">Duration of Movie in minutes</text>
		<text x="160" y="340" class="heavy">Top-10/bottom-10 Movies by duration</text>			</svg>
		</div>
		
		<div id="rightbox">
		<svg id="bar2" width = "100%" height = "80%" >
		<style> .heavy { font:  25px calibri; }
				.light { font:  20px sans; }</style>
		<text x="210" y="300" class="light">Duration of TV Show in seasons</text>
		<text x="160" y="340" class="heavy">Top-10/bottom-10 TV Shows by duration</text>
			</svg>
		</div>
		
		<table class="objecttable">
		 <thead>
		 </thead>
		 <tbody></tbody>
		</table>
		<style>
		 .objecttable td {
		   padding: 8spx;
		 }
		</style>

		<script> 
		//ref: side by side svg https://stackoverflow.com/questions/11333251/how-to-make-two-inser-svg-elements-side-by-side-in-a-bigger-div
	var tooltip = d3.select("body")    //ref:https://chartio.com/resources/tutorials/how-to-show-data-on-mouseover-in-d3js/
    .append("div")  
    .style("position", "absolute") 
    .style("z-index", "15")
	.style("width","250")
	//.style("height","20")
    .style("visibility", "hidden")
    .style("background", "#ADD8E6")
    .text("");

var netflix_pie=[];

d3.csv('netflix_titles1.csv', function(data){
	netflix_pie=data;
	//console.log(deaths_bar)
//piechart=[((TV_MA*100)/total).toFixed(2),((TV_14*100)/total).toFixed(2),((TV_PG*100)/total).toFixed(2),((R*100)/total).toFixed(2),((PG_13*100)/total).toFixed(2),((TV_Y7*100)/total).toFixed(2),((TV_Y*100)/total).toFixed(2),((TV_G*100)/total).toFixed(2),((NR*100)/total).toFixed(2),((TV_Y7_FV*100)/total).toFixed(2),((NC_17*100)/total).toFixed(2)];
		  //Math.round((age4*100)/sum 
drawPiechart(netflix_pie);
}); 
function drawPiechart(netflix_pie){

			
			var margin = {top: 20, right: 0, bottom: 30, left: 100},
						  height = 400,
						  width = 400,
						  w = width - margin.left - margin.right,
						  h = height - margin.top - margin.bottom;
				
						//Create SVG element
			var svg = d3.select("#pie")
						.append("svg")
						.attr("width", '100%')
						.attr("height", '100%')
						.attr("viewBox", "0 0 " + width + " " + height)
						.attr("preserveAspectRatio", "xMinYMin meet")
						.append("g")
						.attr("transform", 
                            "translate(" + margin.left + "," + margin.top + ")");
			svg.selectAll("g.arc").remove();
			
			var piechart=[];
			var rating = {};
			var keys, values;
			//Width and height
			for(let i=0;i<netflix_pie.length;i++){
				rating[netflix_pie[i]['rating']] = 1 + (rating[netflix_pie[i]['rating']] || 0);
			}

			//console.log(tvshow,movies);
			keys = Object.keys(rating);
			values = Object.values(rating);
			//console.log("ratings", rating,values.reduce((a, b) => a + b, 0));
			total=values.reduce((a, b) => a + b, 0);
			for (var i=0; i<values.length; i++){
				piechart.push((values[i]*100/total).toFixed(2));
			}

			var show_type = keys;
			//['TV-MA', 'TV-14', 'TV-PG', 'R', 'PG-13', 'TV-Y7', 'TV-Y', 'PG', 'TV-G', 'NR', 'G', 'TV-Y7-FV', 'NC-17'];
			var netflix_type= values;
			//[TV_MA,TV_14,TV_PG,R,PG_13,TV_Y7,TV_Y,PG,TV_G,NR,G,TV_Y7_FV,NC_17];
			//console.log(dataset);

			var outerRadius = w / 2;
			var innerRadius = 0;
			var arc = d3.svg.arc()
						.innerRadius(innerRadius)
						.outerRadius(outerRadius);
			
			var pie = d3.layout.pie();
			
			//Easy colors accessible via a 10-step ordinal scale
			var color = d3.scale.category10();


			//Set up groups
			var arcs = svg.selectAll("g.arc")
						  .data(pie(piechart))
						  .enter() 
						  .append("g")
						  .attr("class", "arc")
						  .attr("transform", "translate(" + outerRadius + "," + outerRadius + ")")
						  .on("mouseover",(function(d,i){tooltip.text(show_type[i] + "\n" +"Count: " + netflix_type[i]+"\n Percentage:"+piechart[i]); return tooltip.style("visibility", "visible");}))
       .on("mousemove", function(){return tooltip.style("top", (d3.event.pageY-10)+"px").style("left",(d3.event.pageX+10)+"px");})
       .on("mouseout", function(){return tooltip.style("visibility", "hidden")});
			
			//Draw arc paths
			arcs.append("path")
			    .attr("fill", function(d, i) {
			    	return color(i);
			    })
			    .attr("d", arc);
			
			//Labels
			arcs.append("text")
			    .attr("transform", function(d) {

			    	return "translate(" + arc.centroid(d) + ")";
			    })
	   
			    .attr("text-anchor", "middle")
				.attr("font-size","12px")
				.attr("fill","white")
				.attr("font-family","sans-serif")
				
				.text(function(d,i) {
				if(piechart[i]>6){
			    	return show_type[i];}}) 
			arcs.append("text")
			    .attr("transform", function(d) {
			    	return "translate(" + arc.centroid(d) + ")";
			    })
			    .attr("text-anchor", "middle")
				.attr("font-size","12px")
				.attr("fill","white")
				.attr("font-family","sans-serif")
				.attr("y",20)
				
				.text(function(d,i) {
				if(piechart[i]>4){
			    	return d.value + "%";}});
			} 
			
d3.csv("netflix_titles1.csv",function(data1) {
var tooltip = d3.select("body")    //ref:https://chartio.com/resources/tutorials/how-to-show-data-on-mouseover-in-d3js/
    .append("div")  
    .style("position", "absolute")
    .style("z-index", "15")
	.style("width","150")
	//.style("height","20")
    .style("visibility", "hidden")
    .style("background", "#ADD8E6") 
    .text("");
		var genre = {};
		var genre_counts = {};
		var movie_tv = {};
		//console.log("val",netflix_titles);
		for (var i = 0; i < data1.length; i++) {
			//console.log(netflix_data);
			genre[data1[i].listed_in] = 1 + (genre[data1[i].listed_in] || 0);
			movie_tv[data1[i].listed_in] = data1[i].type ; }
		var keys = Object.keys(genre);
		var values = Object.values(genre);
		
		var dataset = [];
		for (var i=0; i< keys.length; i++){
			dataset.push({keys: keys[i], values: parseInt(values[i])});
		}
		
		//console.log('show...years',keys,values); 
		console.log("dataset:",dataset);

    var margin = {top: 20, right: 0, bottom: 21, left: 40},
              height = 300,
              width = 500,
              w = width - margin.left - margin.right,
              h = height - margin.top - margin.bottom;
    
    var svg = d3.select('#bar')
                    .append('svg')
                    .attr("width", '100%')
                    .attr("height", '100%')
                    .attr("viewBox", "0 0 " + width + " " + height)
                    .attr("preserveAspectRatio", "xMinYMin meet")
                    .append("g")
                      .attr("transform", 
                            "translate(" + margin.left + "," + margin.top + ")");
    
    var x = d3.scale.ordinal().rangeRoundBands([0, w], .2, .02);
	var x1 = d3.scale.ordinal().rangeRoundBands([0, w], .90, .2);
    var xAxis = d3.svg.axis()
                  .scale(x)
                  .orient("bottom") 
                  .tickSize(2)
                  .tickPadding(5000); 
    x.domain(dataset.map(function(d) { return d.keys; }));
    
    svg.append("g")
       .attr("class", "axis easting")
       .attr("transform", "translate(0," + h + ")")
       .call(xAxis)
       .selectAll("text")
        .style("text-anchor", "middle")
		.attr("transform", "rotate(0)");
        
    var y = d3.scale.linear().range([h, 0]);
    var yAxis = d3.svg.axis()
                .scale(y)
                .orient("left")
				.tickSize(2)
                .ticks(8);
    y.domain([0, d3.max(dataset, function(d) { return d.values; })]);

    svg.append("g")
        .attr("class", "axis northing")
        .call(yAxis)
        .selectAll("line")
        .attr("x2", w)
							
     function filterbygenre(cname){
		var arr = data1.filter(function(ele) {
		  //return false for the element that matches both the name and the id
		  return (ele.listed_in == cname);
		  });
		return arr;
	 };
	 
	 
	 
    svg.selectAll('rect')
        .data(dataset)
        .enter()
        .append('rect')
        .attr('width', function(d,i){
            return x.rangeBand();
        })
        .attr('height', function(d,i){
            return h - y(d.values);
        })
        .attr('x', function(d,i){
            return x(d.keys);
        })
        .attr('y', function(d,i){
            return y(d.values);
        })
        .attr('fill', function(d) { 
		 if(movie_tv[d.keys]=='Movie'){ return "#4c5768";}
		 else {return "Sienna";}
		 })
		 .on("mouseover",(function(d,i){tooltip.text("Genre:"+d.keys + "\n" +"Count: " + d.values); return tooltip.style("visibility", "visible");}))
       .on("mousemove", function(){return tooltip.style("top", (d3.event.pageY-10)+"px").style("left",(d3.event.pageX+10)+"px");})
       .on("mouseout", function(){return tooltip.style("visibility", "hidden")})
	   .on("click", function(d) {
			drawPiechart(filterbygenre(d.keys));
	   });		
  });
//World map code:

var format = d3.format(",");
// Set tooltips
var tip = d3.tip()
            .attr('class', 'd3-tip')
            .offset([-10, 0])
            .html(function(d) {
			if(d.counts>0){
			return "<strong>Country: </strong><span class='details'>" + d.properties.name + "<br></span>" + "<strong>Count	: </strong><span class='details'>" + format(d.counts) +"</span>";
			}
			else{
              return "<strong>Country: </strong><span class='details'>" + d.properties.name + "<br></span>" + "<strong>Count	: </strong><span class='details'>" + "Not Available" +"</span>";
            }})
var tip1 = d3.tip()
            .attr('class', 'd3-tip')
            .offset([-10, 0])
            .html(function(d) {
			if(d.counts>0){
			return "<strong>Year: </strong><span class='details'>" + parseInt(d.release_year) + "<br></span>" + "<strong>Count	: </strong><span class='details'>" + format(d.counts) +"</span>";
			}
			else{
              return "<strong>Country: </strong><span class='details'>" + d.properties.name + "<br></span>" + "<strong>Count	: </strong><span class='details'>" + "Not Available" +"</span>";
            }})
var margin = {top: 0, right: 0, bottom: 0, left: 0},
            width = 750 - margin.left - margin.right,
            height = 500 - margin.top - margin.bottom;
var color = d3.scale.threshold()
    .domain([-1,0,10,50,200,400,800,1500,1900,2500,3000])
	//orange_color .range(['rgb(255,225,132)','rgb(255,215,122)','rgb(255,205,112)', 'rgb(255,193,77)', 'rgb(255,187,61)', 'rgb(255,184,51)', 'rgb(255,175,26)', 'rgb(245,159,0)', 'rgb(235,152,0)',  'rgb(214,139,0)', 'rgb(204,133,0)',  'rgb(184,119,0)', 'rgb(173,113,0)', 'rgb(163,106,0)'])
    .range(["rgb(247,251,255)", "rgb(222,235,247)", "rgb(198,219,239)", "rgb(158,202,225)", "rgb(107,174,214)", "rgb(66,146,198)","rgb(33,113,181)","rgb(8,81,156)","rgb(8,48,107)"]);
var color1 = d3.scale.threshold()
					.domain([-1,0,10,50,150,300,400,600,800,1000,1200])
					.range(['#ffffff', '#f6eeea', '#ecdcd5', '#e2cbc0', '#d9baab', '#d0a896', '#c69781', '#bc866c', '#b37557', '#aa6342', '#a0522d'])
var color2 = d3.scale.threshold()
    .domain([-1,0,10,50,200,400,800,1500,1900,2500,3000])
    .range(['#ffffff', '#e7e9eb', '#cfd2d7', '#b7bcc3', '#9fa5af', '#888f9a', '#707986', '#586272', '#404c5e', '#28354a', '#101f36']);
var path = d3.geo.path();
var svg2 = d3.select("#main1")
            .append("svg")
            .attr("width", width)
            .attr("height", height) 
			.attr("overflow", "visible")
			.call(d3.behavior.zoom().on("zoom", function () {
				   svg2.attr("transform", "translate(" + d3.event.translate + ")" + " scale(" + d3.event.scale + ")")
			}))
            .append('g') 
            .attr('class', 'map'); 
			
		svg2.selectAll('path').remove();

var projection = d3.geo.mercator()
                   .scale(130)
                  .translate( [width / 2, height / 1.5]);
var path = d3.geo.path().projection(projection);
svg2.call(tip);
queue()
    .defer(d3.json, "world_countries.json") 
    .defer(d3.csv, "netflix_titles1.csv")
    .await(ready);
netflix_data = []
d3.csv("netflix_titles1.csv", function(data) {
	   // console.log(json);  //Log output to console
	   netflix_data=data;
	   //console.log("data",netflix_titles);
	   filterbytype("Movie");
	   });
function filterbytype(type){
var arr = netflix_data.filter(function(ele) {
  //return false for the element that matches both the name and the id
	  return (ele.type == type) });
	return arr; }; 
	   
function ready(error, data, netflix_data) {
  var netflixbyId = {};
  var color_type={};
	//console.log("val",netflix_data);
	for (var i = 0; i < netflix_data.length; i++) {
		//console.log(netflix_data);
		netflixbyId[netflix_data[i].id] = 1 + (netflixbyId[netflix_data[i].id] || 0); 
		color_type[netflix_data[i].type] = 1;
		}
	
	function filterbycountry(country){
		var arr = netflix_data.filter(function(ele) {
		  //return false for the element that matches both the name and the id
		  return (ele.id == country) });
		return arr; };
	console.log("vallllllllll",data.features);	
	
  data.features.forEach(function(d) { 
		  if(netflixbyId[d.id]<4000){
		  d.counts = netflixbyId[d.id] }
		  else{ 
		  netflixbyId[d.id] = -1;
		  }});
	 d3.selectAll("input")
				.on("click", function() {

					var view = d3.select(this).node().value;
					var netflix_data=[];
					d3.csv("netflix_titles1.csv", function(data) {
						netflix_data = data;
					if(view=='By Movies'){
					//console.log(view)

						svg2.selectAll('path').remove();
						queue()
							.defer(d3.json, "world_countries.json") 
							.defer(d3.csv, "netflix_titles1.csv",function(d){ 
								if( d["type"] == "Movie"){return d;}})			
								.await(ready);
						all_years(filterbytype("Movie"));
							}
					if(view=='By Tv Shows'){
					//console.log(view)
						svg2.selectAll('path').remove();
						queue()
							.defer(d3.json, "world_countries.json") 
							.defer(d3.csv, "netflix_titles1.csv",function(d){ 
								if( d["type"] == "TV Show"){return d;}})			
								.await(ready);
						all_years(filterbytype("TV Show"));
								}
								
					if(view=='Reset'){
					//console.log(view)
						svg2.selectAll('path').remove();
						queue()
							.defer(d3.json, "world_countries.json") 
							.defer(d3.csv, "netflix_titles1.csv")			
							.await(ready);
						all_years(netflix_main);
							 }
					if(view=='desc'){
						console.log(netflix_data)
							horizontal_bar1(netflix_data,0);
							horizontal_bar2(netflix_data,0); }
					if(view=='asc'){
						console.log("fff",netflix_data)
							horizontal_bar1(netflix_data,1);
							horizontal_bar2(netflix_data,1); }
					 });
					
						});
  svg2.append("g")
      .attr("class", "countries")
    .selectAll("path")
      .data(data.features)
    .enter().append("path")
      .attr("d", path) 
      .style("fill", function(d) { //console.log(color_type);//console.log(d.id,netflixbyId[d.id],color(netflixbyId[d.id]));
	   var dict = Object.keys(color_type);
	   if(dict.length==2){
			return color(netflixbyId[d.id]);}
	   else{
			if(dict[0]=="Movie"){return color2(netflixbyId[d.id]); }
			else{ return color1(netflixbyId[d.id]);}
			}}) 
      .style('stroke', 'white') 
      .style('stroke-width', 1.5) 
      .style("opacity",0.8) 
      // tooltips 
        .style("stroke","white") 
        .style('stroke-width', 0.3) 
        .on('mouseover',function(d){ 
          tip.show(d);

          d3.select(this)
            .style("opacity", 1)
            .style("stroke","white")
            .style("stroke-width",3);
        })
        .on('mouseout', function(d){ 
          tip.hide(d);

          d3.select(this)
            .style("opacity", 0.8)
            .style("stroke","white")
            .style("stroke-width",0.3);
        })
		.on("click",function(d){
			all_years(filterbycountry(d.id));
		});

  svg2.append("path")
      .datum(topojson.mesh(data.features, function(a, b) { return a.id !== b.id; }))
       //.datum(topojson.mesh(data.features, function(a, b) { return a !== b; }))
      .attr("class", "names")
      .attr("d", path);  
}
	
		
//Width and height
var netflix_main=[];
d3.csv("netflix_titles1.csv", function(data) {
   // console.log(json);  //Log output to console
   netflix_main=data;
   //console.log("data",netflix_titles);
   all_years(netflix_main);
   });
   
   function all_years(data){ 
			var margin = {top: 20, right: 0, bottom: 21, left: 40},
              height = 450,
              width = 750,
              w = width - margin.left - margin.right,
              h = height - margin.top - margin.bottom;
			//Create SVG element
			var color = "#b37557"
			for (i=0;i<data.length;i++){
				if(data[i].type=="Movie"){
				color = "#28354a";}
			}
			
			var svg4 = d3.select("#main2") 
							.append("svg")
							.attr("width", "100%")
							.attr("height", "100%")
							.attr("viewBox", "0 0 " + width + " " + height)
							.attr("preserveAspectRatio", "xMinYMin meet")
							.append("g")
							.attr("transform","translate(" + margin.left + "," + margin.top + ")");
			d3.select("#main2").selectAll("circle").remove();
			var padding = 30;
			
			var dataset, xScale, yScale, xAxis, yAxis;  //Empty, for now

			var parseTime = d3.time.format("%Y").parse;

			//For converting Dates to strings
			var formatTime = d3.time.format("%Y");

			//Function for converting CSV values from strings to Dates and numbers
			var rowConverter = function(d) {
				return {
					release_year: parseTime(d.release_year)
				};
			}


			//Load in the data
			var showyears = {};
			var dataset = []
			for (var i = 0; i < data.length; i++) {
				//console.log(netflix_data);
				dataset.push({"release_year":parseTime(data[i].release_year)});
				showyears[data[i].release_year] = 1 + (showyears[data[i].release_year] || 0); }

				console.log('show...years',showyears);
				console.log('show...years1',dataset);
				//Copy data into global dataset
				//console.log(dataset);
				//Discover start and end dates in dataset
				//Create scale functions 
				xScale = d3.time.scale()
							   .domain([d3.min(dataset,function(d){return d.release_year;}),
							   d3.max(dataset,function(d){return d.release_year;})
										  //endDate plus one day, for padding
								])
							   .range([padding, w - padding]);
				
				//console.log("minimum, maximum",d3.min(dataset,function(d){return formatTime(d.release_year);}),d3.max(dataset,function(d){return formatTime(d.release_year);})	);

				yScale = d3.scale.linear()
							   .domain([
									-10,  //Because I want a zero baseline
									1150
								])
							   .range([h - padding, padding]);
				//Define X axis
				xAxis = d3.svg.axis()
								  .scale(xScale)
								  .tickSize(2)
								  .ticks(10)
								  .orient("bottom")
								  .tickPadding(5000)
								  .tickFormat(formatTime);      
								//console.log("xaxis",  xAxis);
				//Modify scale functions
				xScale = d3.time.scale()
							   .domain([d3.min(dataset,function(d){return formatTime(d.release_year);}),
							   d3.max(dataset,function(d){return formatTime(d.release_year);})
										  //endDate plus one day, for padding
								])
							   .range([padding, w - padding]);
                //Define Y axis
				yAxis = d3.svg.axis()
								  .scale(yScale)
								  .orient("left")
								  .tickSize(2)
								  .ticks(10);
				

				
					
				var tooltip = d3.select("body")    //ref:https://chartio.com/resources/tutorials/how-to-show-data-on-mouseover-in-d3js/
    .append("div")  
    .style("position", "absolute")
    .style("z-index", "20")
    .style("visibility", "hidden")
    .style("background", "#b37557")
    .text("abcd");

				//Generate guide lines
				svg4.selectAll("line")
				   .data(data)
				   .enter().append("div")
				   .append("line")
				   .attr("x1", function(d) {
				   		return xScale(d.release_year);
				   })
				   .attr("x2", function(d) {
						//console.log('showyear',formatTime(d.release_year));
				   		return xScale(showyears[d.release_year]);
				   })
				   
				   .attr("stroke", "#ddd")
				   .attr("stroke-width", 0.75);
				   
				   //Create X axis
	   			svg4.append("g")
	   				.attr("class", "axis")
	   				.attr("transform", "translate(0," + (h - padding) + ")")
	   				.call(xAxis);
	   			//Create Y axis
	   			svg4.append("g")
	   				.attr("class", "axis")
	   				.attr("transform", "translate(" + padding + ",0)")
	   				.call(yAxis);
									
	   			svg4.selectAll("circle")
				   .data(data)
				   .enter()
				   .append("circle")
				   .attr("cx", function(d,i) {
						//console.log("xscale",xScale(d.release_year));
				   		return xScale(d.release_year);
				   })
				   .attr("cy", function(d) {
				   		return yScale(showyears[d.release_year]);
				   })
				   .attr("r", 3)
				   .attr("fill",color)
				 .on("mouseover",(function(d,i){tooltip.text("Year:"+d.release_year + "\n" +"Count: " + showyears[d.release_year]); return tooltip.style("visibility", "visible");}))
				   .on("mousemove", function(){return tooltip.style("top", (d3.event.pageY-10)+"px").style("left",(d3.event.pageX+10)+"px");})
				   .on("mouseout", function(){return tooltip.style("visibility", "hidden")})
				   .on("click", function(d){
						queue()
							.defer(d3.json, "world_countries.json") 
							.defer(d3.csv, "netflix_titles1.csv",function(ele){ 
								if( parseInt(ele["release_year"]) == parseInt(d.release_year)){return ele;}})			
								.await(ready);
						
				   });
}
var imp_val=0;
var netflix_data=[];
	d3.csv("netflix_titles1.csv", function(data1) {
   // console.log(json);  //Log output to console
   netflix_data=data1;
   //console.log("data",netflix_titles);
   
   horizontal_bar1(netflix_data,imp_val);
   horizontal_bar2(netflix_data,imp_val);
   filterbyid("ss");
   });
    function filterbyid(id1){
		
		var arr = netflix_data.filter(function(ele) {
		  //return false for the element that matches both the name and the id
		  return (ele.show_id == id1);
		  });
		//console.log("****************filterbyid",arr[0]);

		return arr[0];
	 };

   function horizontal_bar1(netflix_data,val_imp){
   
   var data1 = [];
   for (var i=0; i<netflix_data.length; i++){
		if(netflix_data[i].type=='Movie'){
			data1.push({'show_id':netflix_data[i].show_id,'duration':parseInt(netflix_data[i].duration)});
		}}
		console.log("data1",data1);
        //sort bars based on value
        var newdata = data1.sort(function (a, b) {
			if(val_imp==0){
            return d3.descending(parseInt(a.duration), parseInt(b.duration));}
			else{
			return d3.ascending(parseInt(a.duration), parseInt(b.duration));}
        })
		var data = data1.slice(0,10);
		console.log("top10 data",data);

        //set up svg using margin conventions - we'll need plenty of room on the left for labels
        var margin = {
            top: 25,
            right: 35,
            bottom: 15,
            left: 100
        };

        var width = 600 - margin.left - margin.right,
            height = 300 - margin.top - margin.bottom;
		
		d3.select("#bar1").selectAll("svg").remove();
        var svg = d3.select("#bar1").append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        var x = d3.scale.linear()
            .range([0, width])
            .domain([0, d3.max(data, function (d) {
                return d.duration;
            })]);

        var y = d3.scale.ordinal()
            .rangeRoundBands([height, 0], .1)
            .domain(data.map(function (d) {
                return d.show_id;
            }));

        //make y axis to show bar names
        var yAxis = d3.svg.axis()
            .scale(y)
            //no tick marks
            .tickSize(2)
            .orient("left");
			
		 var xAxis = d3.svg.axis()
            .scale(x)
            //no tick marks
            .tickSize(2)
            .orient("bottom");

        var gy = svg.append("g")
            .attr("class", "y axis")
            .call(yAxis)
		
		/*var gx = svg.append("g")
            .attr("class", "x axis")
            .call(xAxis)*/

        var bars = svg.selectAll(".bar")
            .data(data)
            .enter()
            .append("g")

        //append rects
        bars.append("rect")
            .attr("class", "bar")
            .attr("y", function (d) {
                return y(d.show_id);
            })
            .attr("height", y.rangeBand())
            .attr("x", 0)
            .attr("width", function (d) {
                return x(d.duration)})
			.attr("fill","#404c5e")
			.on("mouseover",(function(d,i){tooltip.text("Show_type: " + "Movie" + "\n" +"Count: " + d.duration+" Min\n"); return tooltip.style("visibility", "visible");}))
		    .on("mousemove", function(){return tooltip.style("top", (d3.event.pageY-10)+"px").style("left",(d3.event.pageX+10)+"px");})
		    .on("mouseout", function(){return tooltip.style("visibility", "hidden")})
			.on("click", function(d){
				d3.select(".objecttable").selectAll("tr").remove();
				var new_data = filterbyid(d.show_id);
				console.log("******************** new_data",d.show_id);
				var matrix = [
			 {name: "Type", age: new_data.type},
			 {name: "Country", age: new_data.country},
			 {name: "Title", age: new_data.title },
			 {name: "director",age: new_data.director},
			 {name: "Released_year", age: new_data.release_year },
		     {name: "Rating ", age: new_data.rating },
		     {name: "Genre ", age: new_data.listed_in },
		     {name: "description", age: new_data.description } ]; 				
			 var tr = d3.select(".objecttable")
						 .selectAll("tr")
						 .data(matrix)
						 .enter().append("tr");
						//d3.select(".objecttable").selectAll("tr").remove();
			var td = tr.selectAll("td")
					 .data(function(d, i) { return Object.values(d); })
					 .enter().append("td")
					   .text(function(d) { return d; });
							});

        //add a value label to the right of each bar
        bars.append("text")
            .attr("class", "label")
            .attr("y", function (d) {
                return y(d.show_id) + y.rangeBand() / 2 + 4;
            })
            //x position is 3 pixels to the right of the bar
            .attr("x", function (d) {
                return x(d.duration) + 3;
            }) 
            .text(function (d) {
                return d.duration;
            });
        }
		
	function horizontal_bar2(netflix_data,imp_val){
   
   var data1 = [];
   for (var i=0; i<netflix_data.length; i++){
		if(netflix_data[i].type=='TV Show'){
			data1.push({'show_id':netflix_data[i].show_id,'duration':parseInt(netflix_data[i].duration)});
		}}
		console.log("data1",data1);
        //sort bars based on value
        var newdata = data1.sort(function (a, b) {
			if(imp_val==0){
            return d3.descending(parseInt(a.duration), parseInt(b.duration));}
			else{
			return d3.ascending(parseInt(a.duration), parseInt(b.duration));}        })
		var data = newdata.slice(0,10);
		console.log("top10 data",data);

        //set up svg using margin conventions - we'll need plenty of room on the left for labels
        var margin = {
            top: 25,
            right: 25,
            bottom: 15,
            left: 100
        };

        var width = 600 - margin.left - margin.right,
            height = 300 - margin.top - margin.bottom;
		d3.select("#bar2").selectAll("svg").remove();
        var svg = d3.select("#bar2").append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        var x = d3.scale.linear()
            .range([0, width])
            .domain([0, d3.max(data, function (d) {
                return d.duration;
            })]);

        var y = d3.scale.ordinal()
            .rangeRoundBands([height, 0], .1)
            .domain(data.map(function (d) {
                return d.show_id;
            }));

        //make y axis to show bar names
        var yAxis = d3.svg.axis()
            .scale(y)
            //no tick marks
            .tickSize(2)
            .orient("left");
			
		 var xAxis = d3.svg.axis()
            .scale(x)
            //no tick marks
            .tickSize(2)
            .orient("bottom");

        var gy = svg.append("g")
            .attr("class", "y axis")
            .call(yAxis)
		
		/*var gx = svg.append("g")
            .attr("class", "x axis")
            .call(xAxis)*/

        var bars = svg.selectAll(".bar")
            .data(data)
            .enter()
            .append("g")

        //append rects
        bars.append("rect")
            .attr("class", "bar")
            .attr("y", function (d) {
                return y(d.show_id);
            })
            .attr("height", y.rangeBand())
            .attr("x", 0)
            .attr("width", function (d) {
                return x(d.duration)})
			.attr("fill","#b37557")
			.on("mouseover",(function(d,i){tooltip.text("Show_type: " + "TV Show" + "\n" +"Count: " + d.duration+" Seasons\n"); return tooltip.style("visibility", "visible");}))
		    .on("mousemove", function(){return tooltip.style("top", (d3.event.pageY-10)+"px").style("left",(d3.event.pageX+10)+"px");})
		    .on("mouseout", function(){return tooltip.style("visibility", "hidden")})
			.on("click", function(d){
				d3.select(".objecttable").selectAll("tr").remove();
				var new_data = filterbyid(d.show_id);
				console.log("******************** new_data",d.show_id);
				var matrix = [
			 {name: "Type", age: new_data.type},
			 {name: "Country", age: new_data.country},
			 {name: "Title", age: new_data.title },
			 {name: "director",age: new_data.director},
			 {name: "Released_year", age: new_data.release_year },
		     {name: "Rating ", age: new_data.rating },
		     {name: "Genre ", age: new_data.listed_in },
		     {name: "description", age: new_data.description } ]; 				
			 var tr = d3.select(".objecttable")
						 .selectAll("tr")
						 .data(matrix)
						 .enter().append("tr");
						//d3.select(".objecttable").selectAll("tr").remove();
			var td = tr.selectAll("td")
					 .data(function(d, i) { return Object.values(d); })
					 .enter().append("td")
					   .text(function(d) { return d; });
							});

        //add a value label to the right of each bar
        bars.append("text")
            .attr("class", "label")
            .attr("y", function (d) {
                return y(d.show_id) + y.rangeBand() / 2 + 4;
            })
            //x position is 3 pixels to the right of the bar
            .attr("x", function (d) {
                return x(d.duration) + 3;
            }) 
            .text(function (d) {
                return d.duration;
            });
        }
				
	
	
   
		</script>
	</body>
</html>
